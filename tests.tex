\section{Tests}

\markboth{Left}{Tests: k-point generation,  Date: Wed Mar 31 15:00:09 CEST 2004
}

\subsection{k-point generation}

To test the reliability of the k-point generation subroutines, several
tests have been performed, for various lattices. The results are compared
with those of the WIEN2k code.

\subsubsection{Simple Cubic Lattice}

This test has been made for a simple cubic lattice, the total number of
k-points given to the WIEN2k code is 100. Allowing for a shift of the
grid, the result is:

\begin{verbatim}
         1    1    1    1    8  8.0 -7.0  1.5       100 k, div: (  4  4  4)
         2    1    1    3    8 24.0
         3    1    3    3    8 24.0
         4    3    3    3    8  8.0
\end{verbatim}

Not including the shift:

\begin{verbatim}
         1    0    0    0    4  1.0 -7.0  1.5       100 k, div: (  4  4  4)
         2    0    0    1    4  6.0
         3    0    0    2    4  3.0
         4    0    1    1    4 12.0
         5    0    1    2    4 12.0
         6    0    2    2    4  3.0
         7    1    1    1    4  8.0
         8    1    1    2    4 12.0
         9    1    2    2    4  6.0
        10    2    2    2    4  1.0
\end{verbatim}

The result obtained with the subroutine \verb"kgen", is:

\begin{verbatim}
         1    1    1    1    8  8.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    1    1    3    8 24.0
         3    1    3    3    8 24.0
         4    3    3    3    8  8.0
\end{verbatim}

When the shift is included. Instead of testing the result without shift,
we have tested the subroutine \verb"kqgen", since the q-points grid should
be that corresponding to the k-points generated without shift, the result
is:

\begin{verbatim}
         1    1    1    1    8  8.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    1    1    3    8 24.0
         3    1    3    3    8 24.0
         4    3    3    3    8  8.0
END k-points
         1    0    0    0    4  1.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    0    0    1    4  6.0
         3    0    0    2    4  3.0
         4    0    1    1    4 12.0
         5    0    1    2    4 12.0
         6    0    2    2    4  3.0
         7    1    1    1    4  8.0
         8    1    1    2    4 12.0
         9    1    2    2    4  6.0
        10    2    2    2    4  1.0
END q-points
\end{verbatim}

The tetrahedra generated by the WIEN2k code are taken from the file
\verb"case.kgen", the output is modified to make it more understandable:

\begin{verbatim}
    # k-points  #-tets    tet volume 
         4        20  0.260416666667E-02     
          
      weight           kpoints at the corners
         6         1         1         1         1
        12         1         1         1         2        
        18         1         1         2         2        
        12         1         1         2         3        
        24         1         2         2         2        
        24         1         2         2         3
        12         1         2         3         3        
        12         1         2         3         4        
        18         2         2         2         2        
        36         2         2         2         3        
        48         2         2         3         3        
        12         2         2         3         4
        36         2         3         3         3        
        24         2         3         3         4        
        12         2         3         4         4        
        18         3         3         3         3        
        24         3         3         3         4        
        18         3         3         4         4
        12         3         4         4         4         
         6         4         4         4         4
\end{verbatim}

The result obtained with the subroutine \verb"kgen", taken from file
\verb"case.qgen" is:

\begin{verbatim} 
  # k-points #-tets   tet volume 
       4      20  0.260416666667E-02
 
  Tet. No.    k-points at the corners
       1     1     2     3     4      12
       2     2     2     3     4      12
       3     2     3     3     4      24
       4     2     3     4     4      12
       5     1     2     2     3      24
       6     2     2     3     3      48
       7     1     1     2     3      12
       8     1     2     3     3      12
       9     3     3     3     4      24
      10     3     3     4     4      18
      11     3     4     4     4      12
      12     2     3     3     3      36
      13     2     2     2     3      36
      14     1     2     2     2      24
      15     1     1     2     2      18
      16     1     1     1     2      12
      17     4     4     4     4       6
      18     3     3     3     3      18
      19     2     2     2     2      18
      20     1     1     1     1       6
\end{verbatim}

In the case of the subroutine \verb"kqgen", one has to take all the
tetrahedra for the convolutions. The following table shows the results.
The first column is the tetrahedron order number, the next four are the
indexes of the k-points at the corners of the tetrahedra. The columns
beyond the sixth are the order number of the tetrahedron to which the
tetrahedron of the corresponding line is linked through the corresponding
q-point. The 6th. column is equal to the first one since that corresponds
to q = 0, and each tetrahedrom is linked to itself.

\begin{verbatim}
       4     384  0.26041667E-02
       1     1     2     3     4       1       7      13      31      37      61
       2     1     3     2     4       2       8      14      32      38      62
       3     1     2     3     4       3       9      15      33      39      63
       4     1     3     2     4       4      10      16      34      40      64
       5     1     2     3     4       5      11      17      35      41      65
       6     1     3     2     4       6      12      18      36      42      66
       7     2     2     3     4       7      13      19      37      43      67
       8     2     3     3     4       8      14      20      38      44      68
       9     2     3     4     4       9      15      21      39      45      69
      10     2     4     3     4      10      16      22      40      46      70
      11     2     3     3     4      11      17      23      41      47      71
      12     2     3     2     4      12      18      24      42      48      72
      13     2     1     2     3      13      19       1      43      25      49 
      14     2     2     3     3      14      20       2      44      26      50 
      15     2     3     4     3      15      21       3      45      27      51 
      16     2     4     3     3      16      22       4      46      28      52 
      17     2     3     2     3      17      23       5      47      29      53 
      18     2     2     1     3      18      24       6      48      30      54 
      19     1     1     2     3      19       1       7      25      31      55 
      20     1     2     2     3      20       2       8      26      32      56 
      21     1     2     3     3      21       3       9      27      33      57 
      22     1     3     2     3      22       4      10      28      34      58 
      23     1     2     2     3      23       5      11      29      35      59 
      24     1     2     1     3      24       6      12      30      36      60 
      25     2     3     3     4      25      31      37      55      61      85 
      26     2     3     2     4      26      32      38      56      62      86 
      27     2     2     3     4      27      33      39      57      63      87 
      28     2     3     3     4      28      34      40      58      64      88 
      29     2     3     4     4      29      35      41      59      65      89 
      30     2     4     3     4      30      36      42      60      66      90 
      31     3     3     3     4      31      37      43      61      67      91 
      32     3     3     3     4      32      38      44      62      68      92 
      33     3     3     4     4      33      39      45      63      69      93 
      34     3     4     4     4      34      40      46      64      70      94 
      35     3     4     4     4      35      41      47      65      71      95 
      36     3     4     3     4      36      42      48      66      72      96 
      37     3     2     2     3      37      43      25      67      49      73 
      38     3     2     3     3      38      44      26      68      50      74 
      39     3     3     4     3      39      45      27      69      51      75 
      40     3     4     4     3      40      46      28      70      52      76 
      41     3     4     3     3      41      47      29      71      53      77 
      42     3     3     2     3      42      48      30      72      54      78 
      43     2     2     2     3      43      25      31      49      55      79 
      44     2     2     2     3      44      26      32      50      56      80 
      45     2     2     3     3      45      27      33      51      57      81 
      46     2     3     3     3      46      28      34      52      58      82 
      47     2     3     3     3      47      29      35      53      59      83 
      48     2     3     2     3      48      30      36      54      60      84 
      49     2     3     2     3      49      55      61      79      85      13 
      50     2     2     1     3      50      56      62      80      86      14 
      51     2     1     2     3      51      57      63      81      87      15 
      52     2     2     3     3      52      58      64      82      88      16 
      53     2     3     4     3      53      59      65      83      89      17 
      54     2     4     3     3      54      60      66      84      90      18 
      55     3     3     2     3      55      61      67      85      91      19 
      56     3     2     2     3      56      62      68      86      92      20 
      57     3     2     3     3      57      63      69      87      93      21 
      58     3     3     4     3      58      64      70      88      94      22 
      59     3     4     4     3      59      65      71      89      95      23 
      60     3     4     3     3      60      66      72      90      96      24 
      61     3     2     1     2      61      67      49      91      73       1 
      62     3     1     2     2      62      68      50      92      74       2 
      63     3     2     3     2      63      69      51      93      75       3 
      64     3     3     4     2      64      70      52      94      76       4 
      65     3     4     3     2      65      71      53      95      77       5 
      66     3     3     2     2      66      72      54      96      78       6 
      67     2     2     1     2      67      49      55      73      79       7 
      68     2     1     1     2      68      50      56      74      80       8 
      69     2     1     2     2      69      51      57      75      81       9 
      70     2     2     3     2      70      52      58      76      82      10 
      71     2     3     3     2      71      53      59      77      83      11 
      72     2     3     2     2      72      54      60      78      84      12 
      73     1     2     2     3      73      79      85       7      13      37
      74     1     2     1     3      74      80      86       8      14      38
      75     1     1     2     3      75      81      87       9      15      39
      76     1     2     2     3      76      82      88      10      16      40
      77     1     2     3     3      77      83      89      11      17      41
      78     1     3     2     3      78      84      90      12      18      42
      79     2     2     2     3      79      85      91      13      19      43
      80     2     2     2     3      80      86      92      14      20      44
      81     2     2     3     3      81      87      93      15      21      45
      82     2     3     3     3      82      88      94      16      22      46
      83     2     3     3     3      83      89      95      17      23      47
      84     2     3     2     3      84      90      96      18      24      48
      85     2     1     1     2      85      91      73      19       1      25
      86     2     1     2     2      86      92      74      20       2      26
      87     2     2     3     2      87      93      75      21       3      27
      88     2     3     3     2      88      94      76      22       4      28
      89     2     3     2     2      89      95      77      23       5      29
      90     2     2     1     2      90      96      78      24       6      30
      91     1     1     1     2      91      73      79       1       7      31
      92     1     1     1     2      92      74      80       2       8      32
      93     1     1     2     2      93      75      81       3       9      33
      94     1     2     2     2      94      76      82       4      10      34
      95     1     2     2     2      95      77      83       5      11      35
      96     1     2     1     2      96      78      84       6      12      36
      97     2     3     4     4      97     103     109     127     133     157
      98     2     4     3     4      98     104     110     128     134     158
      99     2     3     3     4      99     105     111     129     135     159
     100     2     3     2     4     100     106     112     130     136     160
     101     2     2     3     4     101     107     113     131     137     161
     102     2     3     3     4     102     108     114     132     138     162
     103     3     3     4     4     103     109     115     133     139     163
     104     3     4     4     4     104     110     116     134     140     164
     105     3     4     4     4     105     111     117     135     141     165
     106     3     4     3     4     106     112     118     136     142     166
     107     3     3     3     4     107     113     119     137     143     167
     108     3     3     3     4     108     114     120     138     144     168
     109     3     2     3     3     109     115      97     139     121     145
     110     3     3     4     3     110     116      98     140     122     146
     111     3     4     4     3     111     117      99     141     123     147
     112     3     4     3     3     112     118     100     142     124     148
     113     3     3     2     3     113     119     101     143     125     149
     114     3     2     2     3     114     120     102     144     126     150
     115     2     2     3     3     115      97     103     121     127     151
     116     2     3     3     3     116      98     104     122     128     152
     117     2     3     3     3     117      99     105     123     129     153
     118     2     3     2     3     118     100     106     124     130     154
     119     2     2     2     3     119     101     107     125     131     155
     120     2     2     2     3     120     102     108     126     132     156
     121     3     4     4     4     121     127     133     151     157     181
     122     3     4     3     4     122     128     134     152     158     182
     123     3     3     3     4     123     129     135     153     159     183
     124     3     3     3     4     124     130     136     154     160     184
     125     3     3     4     4     125     131     137     155     161     185
     126     3     4     4     4     126     132     138     156     162     186
     127     4     4     4     4     127     133     139     157     163     187
     128     4     4     4     4     128     134     140     158     164     188
     129     4     4     4     4     129     135     141     159     165     189
     130     4     4     4     4     130     136     142     160     166     190
     131     4     4     4     4     131     137     143     161     167     191
     132     4     4     4     4     132     138     144     162     168     192
     133     4     3     3     3     133     139     121     163     145     169
     134     4     3     4     3     134     140     122     164     146     170
     135     4     4     4     3     135     141     123     165     147     171
     136     4     4     4     3     136     142     124     166     148     172
     137     4     4     3     3     137     143     125     167     149     173
     138     4     3     3     3     138     144     126     168     150     174
     139     3     3     3     3     139     121     127     145     151     175
     140     3     3     3     3     140     122     128     146     152     176
     141     3     3     3     3     141     123     129     147     153     177
     142     3     3     3     3     142     124     130     148     154     178
     143     3     3     3     3     143     125     131     149     155     179
     144     3     3     3     3     144     126     132     150     156     180 
     145     3     4     3     3     145     151     157     175     181     109 
     146     3     3     2     3     146     152     158     176     182     110
     147     3     2     2     3     147     153     159     177     183     111
     148     3     2     3     3     148     154     160     178     184     112
     149     3     3     4     3     149     155     161     179     185     113
     150     3     4     4     3     150     156     162     180     186     114
     151     4     4     3     3     151     157     163     181     187     115
     152     4     3     3     3     152     158     164     182     188     116
     153     4     3     3     3     153     159     165     183     189     117
     154     4     3     4     3     154     160     166     184     190     118
     155     4     4     4     3     155     161     167     185     191     119
     156     4     4     4     3     156     162     168     186     192     120
     157     4     3     2     2     157     163     145     187     169      97
     158     4     2     3     2     158     164     146     188     170      98
     159     4     3     3     2     159     165     147     189     171      99
     160     4     3     4     2     160     166     148     190     172     100
     161     4     4     3     2     161     167     149     191     173     101
     162     4     3     3     2     162     168     150     192     174     102
     163     3     3     2     2     163     145     151     169     175     103
     164     3     2     2     2     164     146     152     170     176     104
     165     3     2     2     2     165     147     153     171     177     105
     166     3     2     3     2     166     148     154     172     178     106
     167     3     3     3     2     167     149     155     173     179     107
     168     3     3     3     2     168     150     156     174     180     108
     169     2     3     3     3     169     175     181     103     109     133
     170     2     3     2     3     170     176     182     104     110     134
     171     2     2     2     3     171     177     183     105     111     135
     172     2     2     2     3     172     178     184     106     112     136
     173     2     2     3     3     173     179     185     107     113     137
     174     2     3     3     3     174     180     186     108     114     138
     175     3     3     3     3     175     181     187     109     115     139
     176     3     3     3     3     176     182     188     110     116     140
     177     3     3     3     3     177     183     189     111     117     141
     178     3     3     3     3     178     184     190     112     118     142
     179     3     3     3     3     179     185     191     113     119     143
     180     3     3     3     3     180     186     192     114     120     144
     181     3     2     2     2     181     187     169     115      97     121
     182     3     2     3     2     182     188     170     116      98     122
     183     3     3     3     2     183     189     171     117      99     123
     184     3     3     3     2     184     190     172     118     100     124
     185     3     3     2     2     185     191     173     119     101     125
     186     3     2     2     2     186     192     174     120     102     126
     187     2     2     2     2     187     169     175      97     103     127
     188     2     2     2     2     188     170     176      98     104     128
     189     2     2     2     2     189     171     177      99     105     129
     190     2     2     2     2     190     172     178     100     106     130
     191     2     2     2     2     191     173     179     101     107     131
     192     2     2     2     2     192     174     180     102     108     132
     193     2     3     4     3     193     199     205     223     229     253
     194     2     4     3     3     194     200     206     224     230     254
     195     2     3     2     3     195     201     207     225     231     255
     196     2     2     1     3     196     202     208     226     232     256
     197     2     1     2     3     197     203     209     227     233     257
     198     2     2     3     3     198     204     210     228     234     258
     200     3     4     4     3     200     206     212     230     236     260
     201     3     4     3     3     201     207     213     231     237     261
     202     3     3     2     3     202     208     214     232     238     262
     203     3     2     2     3     203     209     215     233     239     263
     204     3     2     3     3     204     210     216     234     240     264
     205     3     2     3     2     205     211     193     235     217     241
     206     3     3     4     2     206     212     194     236     218     242
     207     3     4     3     2     207     213     195     237     219     243
     208     3     3     2     2     208     214     196     238     220     244
     209     3     2     1     2     209     215     197     239     221     245
     210     3     1     2     2     210     216     198     240     222     246
     211     2     2     3     2     211     193     199     217     223     247
     212     2     3     3     2     212     194     200     218     224     248
     213     2     3     2     2     213     195     201     219     225     249
     214     2     2     1     2     214     196     202     220     226     250
     215     2     1     1     2     215     197     203     221     227     251
     216     2     1     2     2     216     198     204     222     228     252
     217     3     4     4     3     217     223     229     247     253     277
     218     3     4     3     3     218     224     230     248     254     278
     219     3     3     2     3     219     225     231     249     255     279
     220     3     2     2     3     220     226     232     250     256     280
     221     3     2     3     3     221     227     233     251     257     281
     222     3     3     4     3     222     228     234     252     258     282
     223     4     4     4     3     223     229     235     253     259     283
     224     4     4     4     3     224     230     236     254     260     284
     225     4     4     3     3     225     231     237     255     261     285
     226     4     3     3     3     226     232     238     256     262     286
     227     4     3     3     3     227     233     239     257     263     287
     228     4     3     4     3     228     234     240     258     264     288
     229     4     3     3     2     229     235     217     259     241     265
     230     4     3     4     2     230     236     218     260     242     266
     231     4     4     3     2     231     237     219     261     243     267
     232     4     3     3     2     232     238     220     262     244     268
     233     4     3     2     2     233     239     221     263     245     269
     234     4     2     3     2     234     240     222     264     246     270
     235     3     3     3     2     235     217     223     241     247     271
     236     3     3     3     2     236     218     224     242     248     272
     237     3     3     2     2     237     219     225     243     249     273
     238     3     2     2     2     238     220     226     244     250     274
     239     3     2     2     2     239     221     227     245     251     275
     240     3     2     3     2     240     222     228     246     252     276
     241     3     4     3     2     241     247     253     271     277     205
     242     3     3     2     2     242     248     254     272     278     206
     243     3     2     1     2     243     249     255     273     279     207
     244     3     1     2     2     244     250     256     274     280     208
     245     3     2     3     2     245     251     257     275     281     209
     246     3     3     4     2     246     252     258     276     282     210
     247     4     4     3     2     247     253     259     277     283     211
     248     4     3     3     2     248     254     260     278     284     212
     249     4     3     2     2     249     255     261     279     285     213
     250     4     2     3     2     250     256     262     280     286     214
     251     4     3     3     2     251     257     263     281     287     215
     252     4     3     4     2     252     258     264     282     288     216
     253     4     3     2     1     253     259     241     283     265     193
     254     4     2     3     1     254     260     242     284     266     194
     255     4     3     2     1     255     261     243     285     267     195
     256     4     2     3     1     256     262     244     286     268     196
     257     4     3     2     1     257     263     245     287     269     197
     258     4     2     3     1     258     264     246     288     270     198
     259     3     3     2     1     259     241     247     265     271     199
     260     3     2     2     1     260     242     248     266     272     200
     261     3     2     1     1     261     243     249     267     273     201
     262     3     1     2     1     262     244     250     268     274     202
     263     3     2     2     1     263     245     251     269     275     203
     264     3     2     3     1     264     246     252     270     276     204
     265     2     3     3     2     265     271     277     199     205     229
     266     2     3     2     2     266     272     278     200     206     230
     267     2     2     1     2     267     273     279     201     207     231
     268     2     1     1     2     268     274     280     202     208     232
     269     2     1     2     2     269     275     281     203     209     233
     270     2     2     3     2     270     276     282     204     210     234
     271     3     3     3     2     271     277     283     205     211     235
     272     3     3     3     2     272     278     284     206     212     236
     273     3     3     2     2     273     279     285     207     213     237
     274     3     2     2     2     274     280     286     208     214     238
     275     3     2     2     2     275     281     287     209     215     239
     276     3     2     3     2     276     282     288     210     216     240
     277     3     2     2     1     277     283     265     211     193     217
     278     3     2     3     1     278     284     266     212     194     218
     279     3     3     2     1     279     285     267     213     195     219
     280     3     2     2     1     280     286     268     214     196     220
     281     3     2     1     1     281     287     269     215     197     221
     282     3     1     2     1     282     288     270     216     198     222
     283     2     2     2     1     283     265     271     193     199     223
     284     2     2     2     1     284     266     272     194     200     224
     285     2     2     1     1     285     267     273     195     201     225
     286     2     1     1     1     286     268     274     196     202     226
     287     2     1     1     1     287     269     275     197     203     227
     288     2     1     2     1     288     270     276     198     204     228
     289     1     2     3     3     289     295     301     319     325     349
     290     1     3     2     3     290     296     302     320     326     350
     291     1     2     2     3     291     297     303     321     327     351
     292     1     2     1     3     292     298     304     322     328     352
     293     1     1     2     3     293     299     305     323     329     353
     294     1     2     2     3     294     300     306     324     330     354
     295     2     2     3     3     295     301     307     325     331     355
     296     2     3     3     3     296     302     308     326     332     356
     297     2     3     3     3     297     303     309     327     333     357
     298     2     3     2     3     298     304     310     328     334     358
     299     2     2     2     3     299     305     311     329     335     359
     300     2     2     2     3     300     306     312     330     336     360
     301     2     1     2     2     301     307     289     331     313     337
     302     2     2     3     2     302     308     290     332     314     338
     303     2     3     3     2     303     309     291     333     315     339
     304     2     3     2     2     304     310     292     334     316     340
     305     2     2     1     2     305     311     293     335     317     341
     306     2     1     1     2     306     312     294     336     318     342
     307     1     1     2     2     307     289     295     313     319     343
     308     1     2     2     2     308     290     296     314     320     344
     309     1     2     2     2     309     291     297     315     321     345
     310     1     2     1     2     310     292     298     316     322     346
     311     1     1     1     2     311     293     299     317     323     347
     312     1     1     1     2     312     294     300     318     324     348
     313     2     3     3     3     313     319     325     343     349     373
     314     2     3     2     3     314     320     326     344     350     374
     315     2     2     2     3     315     321     327     345     351     375
     316     2     2     2     3     316     322     328     346     352     376
     317     2     2     3     3     317     323     329     347     353     377
     318     2     3     3     3     318     324     330     348     354     378
     319     3     3     3     3     319     325     331     349     355     379
     320     3     3     3     3     320     326     332     350     356     380
     321     3     3     3     3     321     327     333     351     357     381
     322     3     3     3     3     322     328     334     352     358     382
     323     3     3     3     3     323     329     335     353     359     383
     324     3     3     3     3     324     330     336     354     360     384
     325     3     2     2     2     325     331     313     355     337     361
     326     3     2     3     2     326     332     314     356     338     362
     327     3     3     3     2     327     333     315     357     339     363
     328     3     3     3     2     328     334     316     358     340     364
     329     3     3     2     2     329     335     317     359     341     365
     330     3     2     2     2     330     336     318     360     342     366
     331     2     2     2     2     331     313     319     337     343     367
     332     2     2     2     2     332     314     320     338     344     368
     333     2     2     2     2     333     315     321     339     345     369
     334     2     2     2     2     334     316     322     340     346     370
     335     2     2     2     2     335     317     323     341     347     371
     336     2     2     2     2     336     318     324     342     348     372
     337     2     3     2     2     337     343     349     367     373     301
     338     2     2     1     2     338     344     350     368     374     302
     339     2     1     1     2     339     345     351     369     375     303
     340     2     1     2     2     340     346     352     370     376     304
     341     2     2     3     2     341     347     353     371     377     305
     342     2     3     3     2     342     348     354     372     378     306
     343     3     3     2     2     343     349     355     373     379     307
     344     3     2     2     2     344     350     356     374     380     308
     345     3     2     2     2     345     351     357     375     381     309
     346     3     2     3     2     346     352     358     376     382     310
     347     3     3     3     2     347     353     359     377     383     311
     348     3     3     3     2     348     354     360     378     384     312
     349     3     2     1     1     349     355     337     379     361     289
     350     3     1     2     1     350     356     338     380     362     290
     351     3     2     2     1     351     357     339     381     363     291
     352     3     2     3     1     352     358     340     382     364     292
     353     3     3     2     1     353     359     341     383     365     293
     354     3     2     2     1     354     360     342     384     366     294
     355     2     2     1     1     355     337     343     361     367     295
     356     2     1     1     1     356     338     344     362     368     296
     357     2     1     1     1     357     339     345     363     369     297
     358     2     1     2     1     358     340     346     364     370     298
     359     2     2     2     1     359     341     347     365     371     299
     360     2     2     2     1     360     342     348     366     372     300
     361     1     2     2     2     361     367     373     295     301     325
     362     1     2     1     2     362     368     374     296     302     326
     363     1     1     1     2     363     369     375     297     303     327
     364     1     1     1     2     364     370     376     298     304     328
     365     1     1     2     2     365     371     377     299     305     329
     366     1     2     2     2     366     372     378     300     306     330
     367     2     2     2     2     367     373     379     301     307     331
     368     2     2     2     2     368     374     380     302     308     332
     369     2     2     2     2     369     375     381     303     309     333
     370     2     2     2     2     370     376     382     304     310     334
     371     2     2     2     2     371     377     383     305     311     335
     372     2     2     2     2     372     378     384     306     312     336
     373     2     1     1     1     373     379     361     307     289     313
     374     2     1     2     1     374     380     362     308     290     314
     375     2     2     2     1     375     381     363     309     291     315
     376     2     2     2     1     376     382     364     310     292     316
     377     2     2     1     1     377     383     365     311     293     317
     378     2     1     1     1     378     384     366     312     294     318
     379     1     1     1     1     379     361     367     289     295     319
     380     1     1     1     1     380     362     368     290     296     320
     381     1     1     1     1     381     363     369     291     297     321
     382     1     1     1     1     382     364     370     292     298     322
     383     1     1     1     1     383     365     371     293     299     323
     384     1     1     1     1     384     366     372     294     300     324
\end{verbatim}

\subsubsection{Body Centered Cubic Lattice}

For brevity we just list the results for comparison:

{\bf WIEN2k k-points with shift}

\begin{verbatim}
         1    1    1    1    4  8.0 -7.0  1.5       100 k, div: (  4  4  4)
         2    2    2    1    4 12.0
         3    4    4    1    4  6.0
         4    4    3    2    4 24.0
         5    5    3    3    4  8.0
         6    4    4    3    4  6.0
\end{verbatim}

{\bf WIEN2k k-points without shift}

\begin{verbatim}
         1    0    0    0    4  1.0 -7.0  1.5       100 k, div: (  4  4  4)
         2    1    1    0    4 12.0
         3    2    2    0    4  6.0
         4    2    1    1    4 24.0
         5    2    2    2    4  2.0
         6    4    4    2    4  6.0
         7    4    3    3    4 12.0
         8    4    4    4    4  1.0
\end{verbatim}

{\bf kgen k-points}

\begin{verbatim}
         1    1    1    1    4  8.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    2    2    1    4 12.0
         3    4    4    1    4  6.0
         4    4    3    2    4 24.0
         5    5    3    3    4  8.0
         6    4    4    3    4  6.0
\end{verbatim}

{\bf kqgen k-points and q-points}

\begin{verbatim}
         1    1    1    1    4  8.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    2    2    1    4 12.0
         3    4    4    1    4  6.0
         4    4    3    2    4 24.0
         5    5    3    3    4  8.0
         6    4    4    3    4  6.0
END k-points
         1    0    0    0    4  1.0 -7.0  1.5        64 k, div: (  4  4  4)
         2    1    1    0    4 12.0
         3    2    2    0    4  6.0
         4    2    1    1    4 24.0
         5    2    2    2    4  2.0
         6    4    4    2    4  6.0
         7    1    2    2    4 12.0
         8    2    2    2    4  1.0
END q-points
\end{verbatim}


{\bf WIEN2k tetrahedra with shift}

\begin{verbatim}
         6        46  0.260416666667E-02   
         4         1         1         2         4         
         6         1         1         3         3         
         8         1         1         3         4         
         6         1         1         4         4         
         4         1         2         2         2        
        16         1         2         2         4
        12         1         2         2         5         
         8         1         2         3         4        
        20         1         2         4         4        
        16         1         2         4         5         
         4         1         3         3         3        
        12         1         3         3         4
        20         1         3         4         4         
         4         1         3         4         5         
         4         1         3         4         6         
         8         1         4         4         4        
        12         1         4         4         5         
         4         1         4         5         6
         4         2         2         2         2         
         8         2         2         2         4         
         4         2         2         2         5        
        12         2         2         4         4        
        16         2         2         4         5         
         8         2         3         4         4
        16         2         4         4         4        
        20         2         4         4         5         
         8         2         4         4         6         
         4         2         4         5         5         
         8         2         4         5         6         
         2         3         3         3         3
         4         3         3         3         4         
         4         3         3         4         4         
         8         3         4         4         4         
         4         3         4         4         6         
         4         3         4         5         6         
         8         4         4         4         5
         8         4         4         4         6         
         6         4         4         5         5       
        20         4         4         5         6         
         4         4         4         6         6         
         8         4         5         5         6        
        12         4         5         6         6
         4         4         6         6         6         
         6         5         5         6         6         
         4         5         6         6         6         
         2         6         6         6         6         

\end{verbatim}

{\bf kgen tetrahedra with shift}

\begin{verbatim}
       6      46  0.260416674428E-02 
       1     2     2     2     2       4
       2     1     2     2     2       4
       3     2     2     2     5       4
       4     1     2     4     5      16
       5     1     2     2     5      12
       6     1     4     5     6       4
       7     3     4     4     6       4
       8     1     3     4     6       4
       9     3     4     5     6       4
      10     1     3     4     5       4
      11     1     2     4     4      20
      12     1     2     2     4      16
      13     2     2     2     4       8
      14     2     2     4     5      16
      15     2     4     5     6       8
      16     2     4     4     6       8
      17     4     4     5     6      20
      18     4     5     6     6      12
      19     4     6     6     6       4
      20     4     4     6     6       4
      21     4     4     4     6       8
      22     2     4     4     4      16
      23     2     4     4     5      20
      24     2     2     4     4      12
      25     3     4     4     4       8
      26     1     3     4     4      20
      27     1     4     4     4       8
      28     4     4     4     5       8
      29     4     4     5     5       6
      30     4     5     5     6       8
      31     5     5     6     6       6
      32     1     1     3     3       6
      33     1     1     3     4       8
      34     1     1     4     4       6
      35     1     2     3     4       8
      36     2     3     4     4       8
      37     1     3     3     4      12
      38     3     3     4     4       4
      39     3     3     3     4       4
      40     2     4     5     5       4
      41     6     6     6     6       2
      42     5     6     6     6       4
      43     1     4     4     5      12
      44     1     1     2     4       4
      45     3     3     3     3       2
      46     1     3     3     3       4
\end{verbatim}

Tests for other lattices have also been made with the same success.

\markboth{Left}{Tests: Integration,  Date: Wed Mar 31 15:00:09 CEST 2004
}

\subsection{Integration}

To test the integration subroutines, two model systems have been
calculated, up to now only for the SC lattice. A tight-binding model to
simulate and insulator and the free electron gas to simulate a metal.

\subsubsection{Free electrons}

\begin{center}
\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{dos.pdf}
\caption{Density of states of the free electron gas. Solid line:
calculated using subroutine dos, dashed line: exact value} \label{dos}
\end{figure}
\end{center}
For a free electron gas, the energy bands are given by (in Hartree units):

\begin{equation}
\varepsilon_n(\vec{k})=\frac{1}{2}|\vec{k}+\vec{G}_n|^2
\end{equation}

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{int_dos.pdf}
\caption{Integrated Density of states of the free electron gas. Solid line:
calculated using subroutine idos, dashed line: exact value} \label{idos}
\end{figure}

The expresions for the density of states, Fermi energy and Total energy
are:

\begin{equation}
D(\varepsilon)=\frac{v}{\pi^2}(2\varepsilon)^{\frac{1}{2}}
\end{equation}

\begin{equation}
ID(\varepsilon)=\frac{v}{3\pi^2}(2\varepsilon)^{\frac{3}{2}}
\end{equation}

\begin{equation}
\varepsilon_F =  \frac{1}{2}\left(\frac{3\pi^2
n_e}{v}\right)^{\frac{2}{3}}
\end{equation}

\begin{equation}
E_{tot}= \frac{2\pi}{5}\left(\frac{3\pi^2 n_e}{v}\right)^{\frac{5}{3}}
\end{equation}
where $v$ is the volume of the unit cell and $n_e$ is the number of
electrons per unit cell.

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{efvsik.pdf}
\caption{Fermi Energy as a function of the number of irreducible k-points.
} \label{efvsik}
\end{figure}


Figure \ref{dos} shows the calculated density of states compared to the
exact value. The wiggles appear because no gaussian broadening has been
yet implemented. The decay for energies beyond 1 H is because the model
has a fixed number of bands, that is, not all the bands up to the maximal
energy are included. The integrated density of states is shown in figure
\ref{idos}

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{efvsk.pdf}
\caption{Fermi Energy as a function of the total number of k-points.
} \label{efvsk}
\end{figure}
  
In Figure \ref{efvsik}(\ref{efvsk}) the convergence of the Fermi energy as a function of
the number of irreducible (total) k-point is displayed. 

Finally, the total energy has been calculated in two different ways, by
integrating the eigenvalues over the Brillouin Zone using the subroutine
\verb"tetraint" and by integrating in energy the density of states multiplied by the
corresponding energy. Both resluts are shown in Figures \ref{etotvsik} and
\ref{etotvsk} as a function of the number of irreducible and total
k-points respectivelly. It is clear that integration in k gives a much
better convergence.


\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{etotvsik.pdf}
\caption{Total Energy as a function of the number of irreducible k-points.
} \label{etotvsik}
\end{figure}

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{etotvsk.pdf}
\caption{Total Energy as a function of the total number of k-points.
} \label{etotvsk}
\end{figure}


\subsubsection{Tight Binding bands}

\begin{center}
\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{dostb.pdf}
\caption{Density of states of the Tight Binding model.} \label{dostb}
\end{figure}
\end{center}

The tight binding bands used to test the integration subroutines for
insulators have the form:

\begin{equation}
\varepsilon_n(\vec{k})=\varepsilon_{n0}+t\left(cos(k_x a)+cos(k_y
a)+cos(k_za)\right)
\end{equation}

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{int_dostb.pdf}
\caption{Integrated Density of states of the Tight Binding model.}
\label{idostb}
\end{figure}

The values selected for this test are:
$\varepsilon_{n0}=3n-1$ and $t=\tfrac{1}{3}$. The density of
states for the first three bands are shown in fig. \ref{dostb}, as
calculated with the subroutine \verb"dos.f90".

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{efvsiktb.pdf}
\caption{Fermi Energy as a function of the number of irreducible k-points.
} \label{efvsiktb}
\end{figure}

In Figure \ref{idostb} we show the integrated DOS calculated by using the
subroutine \verb"intdos.f90".  

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{efvsktb.pdf}
\caption{Fermi Energy as a function of the total number of k-points.
} \label{efvsktb}
\end{figure}


With the parameters given above, and two electrons per cell the Fermi
energy can be chosen as the top of the occupied band, giving: $\varepsilon_F=3.0$. 
The total energy is given by:

\begin{equation}
\begin{align}
E_{tot}=&2\left(\frac{v}{(2\pi)^3}\right)\int\limits_{BZ}\varepsilon(\vec{k})d^3k\\
=&2\left(\frac{v}{(2\pi)^3}\right)\iiint\limits_{-\frac{\pi}{a}}^{\frac{\pi}{a}}
\varepsilon_{n0}+t\left(cos(k_x
a)+cos(k_ya)+cos(k_za)\right)dk_xdk_ydk_z\\
=&2\varepsilon_{n0}=4.0
\end{align}
\end{equation}


The results of figures \ref{efvsiktb}
and \ref{efvsktb} show an excelent convergence for k-points grids with
even
number of points in each direction, while it is quite poor for odd number
of k-points.

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{etotvsiktb.pdf}
\caption{Total Energy as a function of the number of irreducible k-points.
} \label{etotvsiktb}
\end{figure}

The total energy, as in the case of free electrons, has been calculated by
integrating the eigenvalues in the Brillouin Zone and also by integrating
the DOS in energy (Figs. \ref{etotvsiktb} and \ref{etotvsktb}. Again, the k-point integration is more precise, in
particular, for an insulating system, the correct result is obtained with
very high precission ever for a few k-points.

\begin{figure}[h]
\includegraphics*[angle=0,width=110mm]{etotvsktb.pdf}
\caption{Total Energy as a function of the total number of k-points.
} \label{etotvsktb}
\end{figure}

\markboth{Left}{Tests: Convolution,  Date: Wed Mar 31 15:00:09 CEST 2004
}

\subsection{Convolution}

\subsubsection{Weights for normal convolution}

The test for the normal weight $sigfreq=1$ should be in here...\\

\subsubsection{Convoluting the polarization in the BZ for real frequency and 
imaginary frequency}

In the program, we calculate the normalized $P/g(E_F)$ and compare it with the 
corresponding part in  \textbf{Lindhard Equation}. To see the accuracy, we define the averaged 
relative error as the summation of the absolute value for the relative error for each $q$ point divided by the number of $q$ point we take. And the change of it as a function of the number we take to divide each axis is 
shown in Figs. \ref{nirkpr} and Figs. \ref{nirkpi} for the real and imaginary frequency cases seperately. \\


\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{nirkpr.pdf}
\caption{The averaged relative error as function of the number of mesh points along each direction for the real frequency case.
} \label{nirkpr}
\end{figure}


\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{nirkpi.pdf}
\caption{The averaged relative error as function of the number of mesh points along each direction for the imaginary frequency case.
} \label{nirkpi}
\end{figure}

Also an example of how well the numberical result agrees with \textbf{Lindhard Equation}, we give an exampel for the case of $\vec{q}$ along $(1,0,0)$ direction in Figs. \ref{mesh13}. And the same for that along $(1,1,1)$ direction in Figs. \ref{mesh13b}, taking real and imaginary frequency for them seperately.\\


\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{mesh13.pdf}
\caption{The normalized $P/g(E_F)$ as function of $q/k_F$ for the case of real frequency when we take 13-mesh.
} \label{mesh13}
\end{figure}


\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{mesh13b.pdf}
\caption{The normalized $P/g(E_F)$ as function of $q/k_F$ for the case of imaginary frequency when we take 13-mesh.
} \label{mesh13b}
\end{figure}

A further example is shown in Figs. \ref{mesh15} for another $k$-mesh.\\

\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{mesh15.pdf}
\caption{The normalized $P/g(E_F)$ as function of $q/k_F$ for the case of real frequency when we take 15-mesh.
} \label{mesh15}
\end{figure}

And since we need to do an integrion over $q$ in the end, so we need to make sure this weight for $q$ in any direction should be right, that is the last test in Figs. \ref{other} for the case $q$ in another direction. 


\begin{figure}[h]
\includegraphics*[angle=0,width=150mm]{other.pdf}
\caption{The normalized $P/g(E_F)$ as function of $q/k_F$ for the case of imaginary frequency when we some other directions.
} \label{other}
\end{figure}




